---
layout: post
title:  "Spring Cloud介绍"
date:   2021-03-06 21:18:54
categories: Distributed Spring-Cloud
tags: Spring-Cloud
excerpt: Spring Cloud介绍
mathjax: true
---

* content
{:toc}

> 

## CAP

1） C (consistency) 强一致性

2） A (available) 可用性

3） P (parition tolerance) 分区容错性

CAP理论的核心：

1. 一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求

2. 根据CAP原理，将NOSQL数据库分成了满足CA原则，满足CP原则和AP原则三大类：

    1）CA: 单点集群，满足一致性，可用性的系统，通常扩展性很差

    2）CP: 满足一致性，分区容错性的系统，通常性能不是特别高

    3）AP: 满足可用性，分区容错性的系统，通常都可能对一致性要求低一些

### 作为注册中心，Eureka比Zookeeper好在哪里？

由于容错性在分布式系统中是必须保证的，因此我们只能在A和C之间权衡

zookeeper保证的是CP

Eureka保证的是AP

zookeeper保证的CP导致当zk的master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间比较长（30-120s），且选举期间整个集群不可用，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因为网络问题使得zk集群失去节点是大概率发生的事情，虽然服务能够恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。

Eureka设计的时候优先保证可用行。Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余节点依旧可以提供注册和查询服务。而Eureka的看客户端在向某个Eureka注册时，如果发现连接失败，会自动切换至其他节点，只要有一台可用，就能够保证注册服务的可能性，只不过查到的可能不是最新的，除此之外，Eureka还有一种保护机制，如果15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现故障，此时会出现以下几种情况：

    1） Eureka不再从注册表中移除因为长时间没收到心跳而应该过期的服务

    2） Eureka仍然能够接受新服务的注册和查询请求，但是不会同步到其他节点上（保证单前节点的可用性）

    3） 当网络稳定时，当前实例新的注册信息会被同步到其他节点